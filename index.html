<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>–ò–Ω–∫–∞—Å—Å–∞—Ç–æ—Ä ‚Äî –¢–µ—Ö–ø–æ–¥–¥–µ—Ä–∂–∫–∞</title>

  <!-- React + ReactDOM (UMD) -->
  <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  
  <!-- Lucide Icons -->
  <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
  <script src="https://unpkg.com/html5-qrcode"></script>
  <style>
    /* –í–∞—à–∏ —Å—Ç–∏–ª–∏ –æ—Å—Ç–∞—é—Ç—Å—è –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π */
    /* ===========================
       üåê GLASS UI ‚Äî —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π —Å—Ç–∏–ª—å –∫–Ω–æ–ø–æ–∫ –∏ –∏–∫–æ–Ω–æ–∫
       =========================== */

    :root {
      --glass-bg: rgba(255, 255, 255, 0.08);
      --glass-border: rgba(255, 255, 255, 0.15);
      --glass-shadow: rgba(0, 0, 0, 0.25);
      --text-light: #ffffff;
      --accent-green: #0b7a43;
      --accent-blue: #2196f3;
      --accent-red: #e53935;
      --accent-orange: #ff6b00;
      --accent-purple: #9c27b0;
      --radius: 18px;
      --transition: all 0.25s ease;
    }

    [data-theme="light"] {
      --glass-bg: rgba(0, 0, 0, 0.06);
      --glass-border: rgba(0, 0, 0, 0.12);
      --glass-shadow: rgba(0, 0, 0, 0.15);
      --text-light: #1a1a1a;
      --accent-green: #0b7a43;
      --accent-blue: #1976d2;
      --accent-red: #d32f2f;
      --accent-orange: #f57c00;
      --accent-purple: #7b1fa2;
    }

    /* === –ë–∞–∑–æ–≤–∞—è —Å—Ç–µ–∫–ª—è–Ω–Ω–∞—è –∫–Ω–æ–ø–∫–∞ === */
    .btn, .tile-btn, button:not(.back):not(.icon-btn) {
      position: relative;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
      padding: 16px 24px;
      border-radius: var(--radius);
      background: var(--glass-bg);
      border: 1px solid var(--glass-border);
      backdrop-filter: blur(16px) saturate(180%);
      -webkit-backdrop-filter: blur(16px) saturate(180%);
      box-shadow: 0 8px 20px var(--glass-shadow);
      color: var(--text-light);
      font-weight: 600;
      font-size: 16px;
      cursor: pointer;
      overflow: hidden;
      transition: var(--transition);
      text-decoration: none;
      border: none;
      font-family: inherit;
    }

    .btn::before, .tile-btn::before, button:not(.back):not(.icon-btn)::before {
      content: "";
      position: absolute;
      inset: 0;
      background: linear-gradient(120deg, rgba(255,255,255,0.2) 0%, transparent 40%, transparent 60%, rgba(255,255,255,0.2) 100%);
      opacity: 0;
      transform: translateX(-100%);
      transition: opacity 0.4s ease, transform 0.6s ease;
    }

    .btn:hover::before, .tile-btn:hover::before, button:not(.back):not(.icon-btn):hover::before {
      opacity: 0.6;
      transform: translateX(100%);
    }

    /* Hover —ç—Ñ—Ñ–µ–∫—Ç */
    .btn:hover, .tile-btn:hover, button:not(.back):not(.icon-btn):hover {
      transform: translateY(-3px) scale(1.02);
      box-shadow: 0 12px 32px rgba(0,0,0,0.35);
      border-color: rgba(255,255,255,0.25);
    }

    .btn:active, .tile-btn:active, button:not(.back):not(.icon-btn):active {
      transform: scale(0.97);
    }

    /* === –ò–∫–æ–Ω–∫–∏ === */
    .tile-icon, .btn-icon, .icon {
      width: 20px;
      height: 20px;
      display: flex;
      align-items: center;
      justify-content: center;
      color: rgba(255,255,255,0.85);
      transition: var(--transition);
      stroke: currentColor;
      stroke-width: 2;
    }

    [data-theme="light"] .tile-icon,
    [data-theme="light"] .btn-icon,
    [data-theme="light"] .icon {
      color: rgba(0,0,0,0.75);
    }

    button:hover .tile-icon {
      color: #00d4ff;
      transform: scale(1.1);
    }

    [data-theme="light"] button:hover .tile-icon {
      color: var(--accent-blue);
    }

    /* === –¶–≤–µ—Ç–æ–≤—ã–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã === */
    .btn-primary, .tile-btn.primary {
      background: rgba(11, 122, 67, 0.25);
      border: 1px solid rgba(11, 122, 67, 0.4);
      box-shadow: 0 8px 24px rgba(11, 122, 67, 0.3);
    }
    .btn-primary:hover { background: rgba(11, 122, 67, 0.35); }

    .btn-secondary, .tile-btn.qr {
      background: linear-gradient(135deg, rgba(33, 150, 243, 0.35), rgba(13, 79, 217, 0.45));
      border: 1px solid rgba(255,255,255,0.25);
      box-shadow: 0 8px 40px rgba(33, 150, 243, 0.35);
    }
    .btn-secondary:hover { background: linear-gradient(135deg, rgba(13, 79, 217, 0.5), rgba(33, 150, 243, 0.5)); }

    .btn-neutral, .tile-btn.archive {
      background: rgba(255, 255, 255, 0.05);
      border: 1px solid rgba(255,255,255,0.15);
      box-shadow: 0 8px 24px rgba(0,0,0,0.3);
    }
    .btn-neutral:hover { background: rgba(255, 255, 255, 0.1); }

    .btn-danger, .service-btn.emergency {
      background: rgba(229, 57, 53, 0.25);
      border: 1px solid rgba(229, 57, 53, 0.4);
      box-shadow: 0 8px 24px rgba(229, 57, 53, 0.3);
      color: #ff6b6b;
    }
    .btn-danger:hover { background: rgba(229, 57, 53, 0.35); }

    /* === QR-–∫–Ω–æ–ø–∫–∞ ‚Äî –æ—Å–æ–±–µ–Ω–Ω–∞—è === */
    .tile-btn.qr {
      font-size: 18px;
      text-transform: uppercase;
      padding: 22px 24px;
      letter-spacing: 0.5px;
      justify-content: center;
    }
    .tile-btn.qr .tile-icon {
      width: 24px;
      height: 24px;
    }

    /* === –í–∞—Ä–∏–∞–Ω—Ç—ã —Ä–∞–∑–º–µ—Ä–∞ === */
    .btn-sm { 
      padding: 12px 16px; 
      font-size: 14px; 
      gap: 8px;
    }
    .btn-sm .tile-icon {
      width: 16px;
      height: 16px;
    }

    /* ===========================
       üé® –ë–∞–∑–æ–≤—ã–µ —Å—Ç–∏–ª–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
       =========================== */

    .video-background {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      object-fit: cover;
      z-index: -2;
    }

    .overlay-dark {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(6, 25, 16, 0.85);
      z-index: -1;
    }

    [data-theme="light"] .overlay-dark {
      background: rgba(246, 247, 243, 0.85);
    }

    html, body, #root {
      height: 100%;
      margin: 0;
      background: transparent;
      color: var(--text-light);
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
      font-family: Inter, "Helvetica Neue", Arial, sans-serif;
    }

    .app {
      max-width: 500px;
      margin: 0 auto;
      padding: 16px;
      box-sizing: border-box;
      position: relative;
      z-index: 1;
    }

    /* Balance Header */
    .balance-header {
      background: var(--glass-bg);
      backdrop-filter: blur(20px);
      border-radius: var(--radius);
      padding: 20px;
      margin-bottom: 20px;
      box-shadow: 0 8px 32px var(--glass-shadow);
      border: 1px solid var(--glass-border);
    }
    .balance-amount {
      font-size: 24px;
      font-weight: 700;
      color: var(--text-light);
      margin-bottom: 4px;
    }
    .balance-label {
      font-size: 14px;
      color: var(--text-light);
      opacity: 0.8;
    }

    header.app-header {
      display: flex;
      gap: 12px;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 20px;
    }
    .brand {
      display: flex;
      gap: 12px;
      align-items: center;
    }
    .brand .logo {
      width: 48px;
      height: 48px;
      border-radius: 12px;
      background: linear-gradient(135deg, var(--accent-green), #0f8a4f);
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 700;
      color: white;
      box-shadow: 0 6px 18px rgba(5,65,48,0.24);
    }
    h1 {
      font-size: 18px;
      margin: 0;
      color: var(--text-light);
    }
    .controls {
      display: flex;
      gap: 8px;
      align-items: center;
    }

    /* Main page */
    .main-actions {
      display: flex;
      flex-direction: column;
      gap: 12px;
      margin-top: 20px;
    }

    /* Service page */
    .service-header {
      text-align: center;
      margin-bottom: 30px;
    }
    .client-info {
      display: flex;
      align-items: center;
      gap: 12px;
      justify-content: center;
      margin-bottom: 16px;
    }
    .client-logo {
      width: 48px;
      height: 48px;
      border-radius: 12px;
      background: var(--accent-green);
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
      color: white;
    }
    .service-actions {
      display: grid;
      grid-template-columns: 1fr;
      gap: 12px;
    }

.service-actions .service-btn-instructions {
  background: rgba(106, 27, 154, 0.25) !important;
  border: 1px solid rgba(106, 27, 154, 0.4) !important;
  box-shadow: 0 8px 24px rgba(106, 27, 154, 0.3) !important;
}

.service-actions .service-btn-instructions:hover {
  background: rgba(106, 27, 154, 0.35) !important;
}
    .service-btn {
      position: relative;
      display: inline-flex;
      align-items: center;
      justify-content: flex-start;
      gap: 10px;
      padding: 16px 24px;
      border-radius: var(--radius);
      background: var(--glass-bg);
      border: 1px solid var(--glass-border);
      backdrop-filter: blur(16px) saturate(180%);
      -webkit-backdrop-filter: blur(16px) saturate(180%);
      box-shadow: 0 8px 20px var(--glass-shadow);
      color: var(--text-light);
      font-weight: 600;
      font-size: 16px;
      cursor: pointer;
      overflow: hidden;
      transition: var(--transition);
      text-decoration: none;
      border: none;
      font-family: inherit;
    }


    .input-group {
      display: flex;
      flex-direction: column;
      gap: 8px;
      margin: 16px 0;
    }
    .input-label {
      font-size: 14px;
      color: var(--text-light);
      opacity: 0.8;
    }
    .us-input {
      padding: 16px;
      border-radius: 12px;
      border: 1px solid var(--glass-border);
      background: var(--glass-bg);
      color: var(--text-light);
      font-size: 16px;
      transition: var(--transition);
      backdrop-filter: blur(10px);
    }
    .us-input:focus {
      outline: none;
      border-color: var(--accent-green);
      box-shadow: 0 0 0 2px rgba(11, 122, 67, 0.2);
    }
    .us-input.error {
      border-color: var(--accent-red);
    }
    .error-text {
      color: var(--accent-red);
      font-size: 14px;
      margin-top: 4px;
    }

    /* Page card */
    .page {
      margin-top: 18px;
    }

    /* Instruction page */
    .instr-header {
      display: flex;
      gap: 8px;
      align-items: center;
      margin-bottom: 12px;
    }
    .back {
      background: transparent;
      border: 1px solid var(--glass-border);
      padding: 8px 12px;
      border-radius: 10px;
      color: var(--text-light);
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 6px;
      font-size: 14px;
    }

    .placeholder {
      display: flex;
      gap: 12px;
      align-items: center;
      padding: 20px;
      border-radius: var(--radius);
      background: var(--glass-bg);
      border: 1px solid var(--glass-border);
      min-height: 140px;
    }
    .placeholder img {
      width: 120px;
      height: 120px;
      object-fit: contain;
      border-radius: 10px;
      background: rgba(255,255,255,0.02);
      padding: 8px;
    }
    .placeholder p {
      margin: 0;
      color: var(--text-light);
      opacity: 0.8;
      font-size: 15px;
      line-height: 1.4;
    }

    /* Chat */
    .chat-wrap {
      display: flex;
      flex-direction: column;
      height: 60vh;
      min-height: 360px;
    }
    .messages {
      flex: 1;
      overflow: auto;
      padding: 12px;
      display: flex;
      flex-direction: column;
      gap: 8px;
    }
    .bubble {
      max-width: 78%;
      padding: 12px 16px;
      border-radius: var(--radius);
      display: inline-block;
      background: var(--glass-bg);
      border: 1px solid var(--glass-border);
    }
    .bubble.me {
      align-self: flex-end;
      background: rgba(11, 122, 67, 0.2);
      border-color: rgba(11, 122, 67, 0.3);
    }
    .bubble.support {
      align-self: flex-start;
      background: var(--glass-bg);
    }

    .msg-meta {
      font-size: 12px;
      color: var(--text-light);
      opacity: 0.6;
      margin-top: 6px;
      text-align: right;
    }

    .chat-input {
      display: flex;
      gap: 8px;
      padding: 12px;
      border-top: 1px solid var(--glass-border);
      background: var(--glass-bg);
      border-radius: 0 0 var(--radius) var(--radius);
    }
    .chat-input input[type="text"] {
      flex: 1;
      padding: 12px;
      border-radius: 12px;
      border: 1px solid var(--glass-border);
      background: var(--glass-bg);
      color: var(--text-light);
    }
    .chat-actions {
      display: flex;
      gap: 6px;
      align-items: center;
    }
    .icon-btn {
      background: transparent;
      border: 1px solid var(--glass-border);
      color: var(--text-light);
      padding: 10px;
      border-radius: 10px;
      cursor: pointer;
      transition: var(--transition);
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .icon-btn:hover {
      background: var(--glass-bg);
      border-color: var(--glass-border);
    }

    /* Phone modal */
    .phone-modal {
      position: fixed;
      left: 50%;
      top: 50%;
      transform: translate(-50%, -50%);
      width: 320px;
      max-width: 90%;
      background: var(--glass-bg);
      backdrop-filter: blur(20px);
      padding: 24px;
      border-radius: var(--radius);
      z-index: 2000;
      box-shadow: 0 24px 60px rgba(0,0,0,0.6);
      text-align: center;
      border: 1px solid var(--glass-border);
    }
    .overlay {
      position: fixed;
      left: 0;
      top: 0;
      right: 0;
      bottom: 0;
      background: rgba(0,0,0,0.5);
      z-index: 1500;
      backdrop-filter: blur(5px);
    }

    /* Rating stars */
    .rating-stars {
      display: flex;
      gap: 8px;
      justify-content: center;
      margin: 20px 0;
    }
    .star {
      font-size: 24px;
      cursor: pointer;
      transition: var(--transition);
      color: var(--text-light);
      opacity: 0.5;
    }
    .star:hover,
    .star.active {
      color: #ffd700;
      opacity: 1;
      transform: scale(1.2);
    }

    /* Success modal */
    .success-modal {
      background: rgba(39, 174, 96, 0.9);
      border: 1px solid rgba(39, 174, 96, 0.6);
    }

    /* Footer / nav */
    .bottom-nav {
      display: flex;
      gap: 12px;
      justify-content: space-around;
      padding: 16px;
      margin-top: 20px;
      background: var(--glass-bg);
      border-radius: var(--radius);
      border: 1px solid var(--glass-border);
    }

    /* Archive view */
    .archive-messages {
      background: var(--glass-bg);
      border-radius: var(--radius);
      padding: 16px;
      margin-top: 16px;
      max-height: 400px;
      overflow-y: auto;
      border: 1px solid var(--glass-border);
    }

    /* small screens adjustments */
    @media (max-width: 560px) {
  .brand h1 { font-size: 16px; }
  .chat-wrap { height: 58vh; }
  .btn, .tile-btn { padding: 14px 20px; }
  
  /* –î–æ–±–∞–≤—å—Ç–µ —ç—Ç–æ */
  .app {
    padding: 12px;
  }
  
  .service-btn {
    padding: 14px 16px;
    font-size: 14px;
  }
}

@media (max-width: 440px) {
  .app {
    padding: 8px;
  }
  
  .service-btn {
    padding: 12px 14px;
    font-size: 13px;
  }
  
  .balance-header {
    padding: 16px;
  }
  
  .balance-amount {
    font-size: 20px;
  }
}

@media (max-width: 360px) {
  .app {
    padding: 6px;
  }
  
  .service-btn {
    padding: 10px 12px;
    font-size: 12px;
  }
  
  .brand h1 {
    font-size: 14px;
  }
  
  .brand .logo {
    width: 40px;
    height: 40px;
  }
}
  </style>
</head>
<body>
  <div id="root"></div>

  <script>
  (function(){
    const e = React.createElement;
    const {useState, useEffect, useRef} = React;

    // ---- Utilities ----
    const uid = (prefix='id') => prefix + Math.random().toString(36).slice(2,9);
    const storage = {
      get(k, fallback) { try { const v = localStorage.getItem(k); return v ? JSON.parse(v) : fallback; } catch(e){ return fallback } },
      set(k, v) { localStorage.setItem(k, JSON.stringify(v)); }
    };

    // –î–∞–Ω–Ω—ã–µ –∫–ª–∏–µ–Ω—Ç–æ–≤
    const CLIENTS_DATA = {
      1: { name: '–°–±–µ—Ä', shortName: '–°–±–µ—Ä', logo: '–°', color: '#0b7a43', isSber: true },
      2: { name: '–ê–ª—å—Ñ–∞ –ë–∞–Ω–∫', shortName: '–ê–ª—å—Ñ–∞', logo: '–ê', color: '#ef3124', isSber: false },
      3: { name: '–°–æ–≤–∫–æ–º–±–∞–Ω–∫', shortName: '–°–æ–≤–∫–æ–º', logo: '–°', color: '#8cc054', isSber: false },
      4: { name: '–¢-–ë–∞–Ω–∫', shortName: '–¢-–ë–∞–Ω–∫', logo: '–¢', color: '#ff6b00', isSber: false }
    };
    function useLucideIcons() {
  useEffect(() => {
    const timer = setTimeout(() => {
      if (window.lucide) {
        window.lucide.createIcons();
      }
    }, 50);
    return () => clearTimeout(timer);
  });
}
    // --- Simple hash router ---
    function useHashRoute() {
      const [hash, setHash] = useState(location.hash || '#/');
      useEffect(() => {
        const onHash = () => setHash(location.hash || '#/');
        window.addEventListener('hashchange', onHash);
        return () => window.removeEventListener('hashchange', onHash);
      }, []);
      const navigate = (to) => { location.hash = to; setHash(to); }
      return { hash, navigate };
    }

    // --- App ---
    function App(){
      useLucideIcons();
      const {hash, navigate} = useHashRoute();
      const [theme, setTheme] = useState(storage.get('theme','dark'));
      const [balance, setBalance] = useState(storage.get('balance', 0));
      const [chats, setChats] = useState(storage.get('chats', {
        'client': [],
        'sppous': [],
        'curus': []
      }));
      const [archive, setArchive] = useState(storage.get('archive', []));

      useEffect(()=> {
        storage.set('chats', chats);
      }, [chats]);

      useEffect(()=> {
        storage.set('archive', archive);
      }, [archive]);

      useEffect(()=> {
        storage.set('balance', balance);
      }, [balance]);

      useEffect(()=> {
        document.documentElement.setAttribute('data-theme', theme);
        storage.set('theme', theme);
      }, [theme]);

      const addPoints = (points) => {
        setBalance(prev => {
          const newBalance = prev + points;
          storage.set('balance', newBalance);
          return newBalance;
        });
      };

      const clearChat = (chatId) => {
        setChats(prev => {
          const copy = {...prev};
          copy[chatId] = [];
          return copy;
        });
      };

      // route parsing
      const route = (hash || '#/').replace(/^#/, '');
      const parts = route.split('/').filter(Boolean);
      let page = 'home', param = null, usNumber = null, archiveId = null;
      if(parts.length>0){
        if(parts[0]==='service'){ page='service'; usNumber = parts[1]; }
        if(parts[0]==='instructions'){ page='instructions'; usNumber = parts[1]; }
        if(parts[0]==='chat'){ page='chat'; param = parts[1]; usNumber = parts[2]; }
        if(parts[0]==='archive'){ page='archive'; }
        if(parts[0]==='archive-view'){ page='archive-view'; archiveId = parts[1]; }
      }

      const sendMessage = (chatId, msg) => {
        const newMsg = {...msg, id: uid('m'), ts: Date.now()};
        setChats(prev => {
          const copy = {...prev};
          copy[chatId] = [...(copy[chatId]||[]), newMsg];
          return copy;
        });
      };

      const attachFileToChat = (chatId, file) => {
        const url = URL.createObjectURL(file);
        sendMessage(chatId, {type:'file', fileName:file.name, url});
      };

      const pushImageFromCapture = (chatId, file) => {
        const url = URL.createObjectURL(file);
        sendMessage(chatId, {type:'image', url});
      };

      const addToArchive = (chatData) => {
        const archivedChat = {
          ...chatData, 
          id: uid('arch'), 
          closedAt: Date.now(),
          messages: [...chatData.messages]
        };
        setArchive(prev => [...prev, archivedChat]);
        return archivedChat;
      };

      return e('div',{className:'app'},
        e(BalanceHeader, {balance}),
        e(Header, {theme, setTheme, navigate}),
        e('div', {className:'page'},
          page==='home' && e(HomePage, {navigate, addPoints}),
          page==='service' && e(ServicePage, {usNumber, navigate, sendMessage, addPoints}),
          page==='instructions' && e(InstructionsPage, {usNumber, navigate}),
          page==='chat' && e(ChatPage, {
            chatId: param,
            usNumber: usNumber,
            chats:chats[param] || [],
            onSend: (m)=> sendMessage(param, m),
            onAttach: (file)=> attachFileToChat(param, file),
            onImage: (file)=> pushImageFromCapture(param, file),
            onArchive: addToArchive,
            onClearChat: () => clearChat(param),
            navigate
          }),
          page==='archive' && e(ArchivePage, {archive, navigate}),
          page==='archive-view' && e(ArchiveViewPage, {archive, archiveId, navigate})
        ),
        // e('div',{className:'bottom-nav'},
        //   e('button',{className:'btn btn-neutral', onClick:()=>navigate('#/')}, 
        //     e('i',{className:'tile-icon', 'data-lucide':'home'}), '–ì–ª–∞–≤–Ω–∞—è'),
        //   e('button',{className:'btn btn-neutral', onClick:()=>navigate('#/archive')}, 
        //     e('i',{className:'tile-icon', 'data-lucide':'archive'}), '–ê—Ä—Ö–∏–≤')
        // )
      );
    }

    function BalanceHeader({balance}) {
      return e('div', {className: 'balance-header'},
        e('div', {className: 'balance-amount'}, `${balance} –ë–∞–ª–ª–æ–≤`),
        e('div', {className: 'balance-label'}, '–í–∞—à –±–∞–ª–∞–Ω—Å')
      );
    }

    function Header({theme,setTheme,navigate}){
      return e('header',{className:'app-header'},
        e('div',{className:'brand'},
          e('div',{className:'logo'}, '–ò'),
          e('div',null, e('h1',null,'–ò–Ω–∫–∞—Å—Å–∞—Ç–æ—Ä ‚Äî —Ç–µ—Ö–ø–æ–¥–¥–µ—Ä–∂–∫–∞'))
        ),
        e('div',{className:'controls'},
          e('button',{className:'btn btn-sm btn-neutral', onClick:()=> { 
            setTheme(t => t === 'light' ? 'dark' : 'light'); 
          }}, 
            theme==='light' 
              ? e('i',{className:'tile-icon', 'data-lucide':'moon'})
              : e('i',{className:'tile-icon', 'data-lucide':'sun'}),
            theme==='light' ? '–¢—ë–º–Ω–∞—è' : '–°–≤–µ—Ç–ª–∞—è'
          )
        )
      );
    }

    function HomePage({navigate, addPoints}){
      const [usNumber, setUsNumber] = useState('');
      const [error, setError] = useState('');

      const validateUS = (number) => {
        const num = parseInt(number);
        if (!number) return '–í–≤–µ–¥–∏—Ç–µ –Ω–æ–º–µ—Ä –£–°(1-–°–ë–ï–†, 2-–ê–õ–¨–§–ê, 3-–°–û–í–ö–û–ú–ë–ê–ù–ö, 4-–¢-–ë–ê–ù–ö)';
        if (isNaN(num)) return '–¢–æ–ª—å–∫–æ —á–∏—Å–ª–∞ —Ä–∞–∑—Ä–µ—à–µ–Ω—ã';
        if (num < 1 || num > 4) return '–í–≤–µ–¥–∏—Ç–µ –Ω–æ–º–µ—Ä –£–° 1-4 (1-–°–ë–ï–†, 2-–ê–õ–¨–§–ê, 3-–°–û–í–ö–û–ú–ë–ê–ù–ö, 4-–¢-–ë–ê–ù–ö)';
        return '';
      };

      const handleUSSubmit = () => {
        const validationError = validateUS(usNumber);
        if (validationError) {
          setError(validationError);
          return;
        }
        setError('');
        navigate(`#/service/${usNumber}`);
      };

      const handleInputChange = (value) => {
        const numbersOnly = value.replace(/[^\d]/g, '');
        setUsNumber(numbersOnly);
        if (numbersOnly) {
          setError(validateUS(numbersOnly));
        } else {
          setError('');
        }
      };

      const showQRModal = () => {
        const modal = document.createElement('div');
        modal.innerHTML = `
          <div class="overlay"></div>
          <div class="phone-modal" style="max-width: 420px;">
            <h3>üì∑ –°–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ QR-–∫–æ–¥–∞</h3>
            <div style="text-align: center; margin-bottom: 15px;">
              <p>–ù–∞–≤–µ–¥–∏—Ç–µ –∫–∞–º–µ—Ä—É –Ω–∞ QR-–∫–æ–¥ –£–° –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –ø–µ—Ä–µ—Ö–æ–¥–∞</p>
            </div>
            <div id="qr-reader" style="width: 100%; margin: 15px 0;"></div>
            <div id="qr-result" style="margin: 10px 0; min-height: 20px; text-align: center;"></div>
            <div id="qr-status" style="margin: 10px 0; min-height: 20px; text-align: center; font-size: 14px; opacity: 0.8;"></div>
            <div style="display: flex; gap: 10px; justify-content: center; margin-top: 15px;">
              <button class="btn btn-neutral" id="stop-scan">–û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ</button>
              <button class="btn btn-primary" id="close-qr">–ó–∞–∫—Ä—ã—Ç—å</button>
            </div>
          </div>
        `;
        
        document.body.appendChild(modal);
        
        let html5QrcodeScanner = null;
        const qrReader = document.getElementById('qr-reader');
        const qrResult = document.getElementById('qr-result');
        const qrStatus = document.getElementById('qr-status');
        const stopButton = document.getElementById('stop-scan');
        const closeButton = document.getElementById('close-qr');
        
        qrStatus.innerHTML = 'üîÑ –ó–∞–ø—É—Å–∫ –∫–∞–º–µ—Ä—ã...';
        
        try {
          html5QrcodeScanner = new Html5QrcodeScanner(
            "qr-reader", 
            { 
              fps: 10, 
              qrbox: { width: 250, height: 250 },
              supportedScanTypes: [Html5QrcodeScanType.SCAN_TYPE_CAMERA],
              formatsToSupport: [Html5QrcodeSupportedFormats.QR_CODE],
              showTorchButtonIfSupported: true,
              showZoomSliderIfSupported: true,
            }, 
            false
          );
          
          html5QrcodeScanner.render(
            (decodedText, decodedResult) => {
              qrStatus.innerHTML = '‚úÖ –ö–æ–¥ —Ä–∞—Å–ø–æ–∑–Ω–∞–Ω!';
              
              if (decodedText.includes('vonshirg.github.io') && decodedText.includes('/#/service/')) {
                qrResult.innerHTML = `<div style="color: var(--accent-green);">
                  <strong>–ù–∞–π–¥–µ–Ω–∞ —Å—Å—ã–ª–∫–∞ –Ω–∞ –£–°:</strong><br>
                  <small>${decodedText}</small>
                </div>`;
                
                const usNumberMatch = decodedText.match(/service\/(\d+)/);
                if (usNumberMatch) {
                  const scannedUsNumber = usNumberMatch[1];
                  
                  qrStatus.innerHTML = `üîÑ –ü–µ—Ä–µ—Ö–æ–¥ –∫ –£–° ‚Ññ${scannedUsNumber}...`;
                  
                  if (html5QrcodeScanner) {
                    html5QrcodeScanner.clear();
                  }
                  
                  setTimeout(() => {
                    modal.remove();
                    navigate(`#/service/${scannedUsNumber}`);
                  }, 1500);
                }
              } else {
                qrResult.innerHTML = `<div style="color: var(--accent-red);">
                  ‚ùå –ù–µ–≤–µ—Ä–Ω—ã–π QR-–∫–æ–¥<br>
                  <small>–û–∂–∏–¥–∞–µ—Ç—Å—è —Å—Å—ã–ª–∫–∞ –Ω–∞ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ —Å–±–æ—Ä–∞</small>
                </div>`;
                
                setTimeout(() => {
                  qrResult.innerHTML = '';
                  qrStatus.innerHTML = 'üì∑ –ü—Ä–æ–¥–æ–ª–∂–∞–π—Ç–µ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ...';
                }, 3000);
              }
            },
            (errorMessage) => {
              if (!errorMessage.includes('NotFoundException')) {
                qrStatus.innerHTML = 'üì∑ –ù–∞–≤–µ–¥–∏—Ç–µ –∫–∞–º–µ—Ä—É –Ω–∞ QR-–∫–æ–¥...';
              }
            }
          );
          
          setTimeout(() => {
            qrStatus.innerHTML = '‚úÖ –ö–∞–º–µ—Ä–∞ –≥–æ—Ç–æ–≤–∞. –ù–∞–≤–µ–¥–∏—Ç–µ –Ω–∞ QR-–∫–æ–¥...';
          }, 1000);
          
        } catch (error) {
          qrStatus.innerHTML = '';
          qrResult.innerHTML = `<div style="color: var(--accent-red); text-align: center;">
            ‚ùå –û—à–∏–±–∫–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ –∫–∞–º–µ—Ä–µ<br>
            <small>${error.message || '–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è –±—Ä–∞—É–∑–µ—Ä–∞'}</small>
          </div>`;
        }
        
        stopButton.onclick = () => {
          if (html5QrcodeScanner) {
            html5QrcodeScanner.clear();
            qrResult.innerHTML = '<div style="color: var(--accent-orange);">‚è∏Ô∏è –°–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ</div>';
            qrStatus.innerHTML = '–î–ª—è –≤–æ–∑–æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∑–∞–∫—Ä–æ–π—Ç–µ –∏ –æ—Ç–∫—Ä–æ–π—Ç–µ —Å–∫–∞–Ω–µ—Ä —Å–Ω–æ–≤–∞';
          }
        };
        
        closeButton.onclick = () => {
          if (html5QrcodeScanner) {
            html5QrcodeScanner.clear();
          }
          modal.remove();
        };
        
        modal.querySelector('.overlay').onclick = () => {
          if (html5QrcodeScanner) {
            html5QrcodeScanner.clear();
          }
          modal.remove();
        };
      };

      return e('div',null,
        e('div',{className:'main-actions'},
          e('button',{className:'tile-btn qr', onClick:showQRModal},
            e('i',{className:'tile-icon', 'data-lucide':'qrcode'}),
            e('span',null, '–°–∫–∞–Ω–∏—Ä–æ–≤–∞—Ç—å QR-–∫–æ–¥')
          ),
          
          e('div',{className:'input-group'},
            e('label',{className:'input-label'}, '–í–≤–µ–¥–∏—Ç–µ –Ω–æ–º–µ—Ä –£–°(1-–°–ë–ï–†, 2-–ê–õ–¨–§–ê, 3-–°–û–í–ö–û–ú–ë–ê–ù–ö, 4-–¢-–ë–ê–ù–ö)'),
            e('input',{
              className: `us-input ${error ? 'error' : ''}`,
              type: 'text',
              placeholder: '–í–≤–µ–¥–∏—Ç–µ –Ω–æ–º–µ—Ä –£–°...',
              value: usNumber,
              onChange: (e) => handleInputChange(e.target.value),
              onKeyDown: (e) => { if(e.key === 'Enter') handleUSSubmit(); }
            }),
            error && e('div',{className:'error-text'}, error)
          ),
          
          e('button',{className:'tile-btn primary', onClick:handleUSSubmit},
            e('i',{className:'tile-icon', 'data-lucide':'play'}),
            e('span',null, '–ù–∞—á–∞—Ç—å –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏–µ')
          ),
          
          e('button',{className:'tile-btn archive', onClick:()=> navigate('#/archive')},
            e('i',{className:'tile-icon', 'data-lucide':'archive'}),
            e('span',null, '–ê—Ä—Ö–∏–≤ –æ–±—Ä–∞—â–µ–Ω–∏–π')
          )
        )
      );
    }

    function ServicePage({usNumber, navigate, sendMessage, addPoints}){
      const client = CLIENTS_DATA[usNumber] || CLIENTS_DATA[1];
      useLucideIcons();
  const getChatIdForButton = (buttonType) => {
  if (client.isSber) return 'curus'; // –î–ª—è –°–±–µ—Ä–∞ –≤—Å–µ –∫–Ω–æ–ø–∫–∏ –≤ —á–∞—Ç –¶–£–†–£–°
  if (buttonType === 'emergency' || buttonType === 'extraTime') return 'sppous';
  return 'client'; // –û—Å—Ç–∞–ª—å–Ω—ã–µ –∫–Ω–æ–ø–∫–∏ –≤ —á–∞—Ç –¢–ü –∫–ª–∏–µ–Ω—Ç–∞
};

      const startAutoChatSequence = (chatId, sequenceType, customParams = {}) => {
        sendMessage(chatId, {type: 'text', text: customParams.initialMessage || `–û–∂–∏–¥–∞–Ω–∏–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –æ–ø–µ—Ä–∞—Ç–æ—Ä–∞ –ø–æ –æ–±—Ä–∞—â–µ–Ω–∏—é –ø–æ –£–° ‚Ññ${usNumber} –∫–ª–∏–µ–Ω—Ç–∞ ${client.name}`});
        navigate(`#/chat/${chatId}/${usNumber}`);
        
        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–π
        setTimeout(() => {
          if (sequenceType === 'emergency' || sequenceType === 'extraTime') {
            sendMessage(chatId, {type: 'text', text: "–ó–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ! –Ø –æ–ø–µ—Ä–∞—Ç–æ—Ä –°–ü–ü–û–£–°, –º–µ–Ω—è –∑–æ–≤—É—Ç –ò–≥–æ—Ä—å, –∫–∞–∫–æ–π —É –í–∞—Å –≤–æ–ø—Ä–æ—Å"});
            sendMessage(chatId, {type: 'text', text: "–ò–¥–µ—Ç –∑–≤–æ–Ω–æ–∫"});
            
            setTimeout(() => {
              showQuestionSolvedModal(chatId, 'sppous');
            }, 3000);
          } else if (sequenceType === 'load') {
            const success = Math.random() > 0.5;
            if (success) {
              sendMessage(chatId, {type: 'text', text: "–ó–∞–≥—Ä—É–∑–∫–∞ –æ—Å—É—â–µ—Å—Ç–≤–ª–µ–Ω–∞ —É—Å–ø–µ—à–Ω–æ"});
              setTimeout(() => {
                const modal = document.createElement('div');
                modal.innerHTML = `
                  <div class="overlay"></div>
                  <div class="phone-modal success-modal">
                    <h3>üéâ –ü–æ–∑–¥—Ä–∞–≤–ª—è–µ–º!</h3>
                    <p>–í–∞–º –Ω–∞—á–∏—Å–ª–µ–Ω–æ 100 –ë–∞–ª–ª–æ–≤</p>
                    <button class="btn btn-primary" onclick="this.closest('.phone-modal').parentElement.remove()" style="margin-top:15px;">–û—Ç–ª–∏—á–Ω–æ!</button>
                  </div>
                `;
                document.body.appendChild(modal);
                addPoints(100);
                setTimeout(() => showRatingModal(chatId), 2000);
              }, 1000);
            } else {
              sendMessage(chatId, {type: 'text', text: "–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏!!! –û–±—Ä–∞—Ç–∏—Ç–µ—Å—å –≤ –ø–æ–¥–¥–µ—Ä–∂–∫—É"});
              setTimeout(() => {
                sendMessage(chatId, {type: 'text', text: "–ò–¥–µ—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –æ–ø–µ—Ä–∞—Ç–æ—Ä–∞ –¢–ü –∫–ª–∏–µ–Ω—Ç–∞"});
                setTimeout(() => {
                  sendMessage(chatId, {type: 'text', text: "–ó–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ, –º–µ–Ω—è –∑–æ–≤—É—Ç –û–ª—å–≥–∞, —è –æ–ø–µ—Ä–∞—Ç–æ—Ä —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–æ–π –ø–æ–¥–¥–µ—Ä–∂–∫–∏ –∫–ª–∏–µ–Ω—Ç–∞. –ö–∞–∫–æ–π —É –í–∞—Å –≤–æ–ø—Ä–æ—Å"});
                  sendMessage(chatId, {type: 'text', text: "–ò–¥–µ—Ç –∑–≤–æ–Ω–æ–∫..."});
                  setTimeout(() => showQuestionSolvedModal(chatId, 'client'), 3000);
                }, 2000);
              }, 2000);
            }
          } else if (sequenceType === 'unload') {
            const success = Math.random() > 0.5;
            if (success) {
              sendMessage(chatId, {type: 'text', text: "–í—ã–≥—Ä—É–∑–∫–∞ —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∞"});
              setTimeout(() => showRatingModal(chatId), 2000);
            } else {
              sendMessage(chatId, {type: 'text', text: "–í—ã–≥—Ä—É–∑–∫–∞ –Ω–µ —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∞, —Å–ª–µ–¥—É–π—Ç–µ –¥–∞–ª–µ–µ –ø–æ –º–∞—Ä—à—Ä—É—Ç—É"});
              setTimeout(() => showRatingModal(chatId), 2000);
            }
          } else if (sequenceType === 'noAccess') {
            sendMessage(chatId, {type: 'text', text: "–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –ø—Ä–∏–Ω—è—Ç–∞"});
          }
        }, 2000);
      };

      const showQuestionSolvedModal = (chatId, operatorType) => {
        const modal = document.createElement('div');
        modal.innerHTML = `
          <div class="overlay"></div>
          <div class="phone-modal">
            <h3>–í–∞—à –≤–æ–ø—Ä–æ—Å —Ä–µ—à–µ–Ω?</h3>
            <div style="display: flex; gap: 10px; justify-content: center; margin: 20px 0;">
              <button class="btn btn-primary" id="question-yes">–î–∞</button>
              <button class="btn btn-neutral" id="question-no">–ù–µ—Ç</button>
            </div>
          </div>
        `;
        
        document.body.appendChild(modal);
        
        document.getElementById('question-yes').onclick = () => {
          modal.remove();
          showRatingModal(chatId);
        };
        
        document.getElementById('question-no').onclick = () => {
          modal.remove();
          if (operatorType === 'sppous') {
            sendMessage(chatId, {type: 'text', text: "–ò–¥–µ—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –æ–ø–µ—Ä–∞—Ç–æ—Ä–∞ –¢–ü –∫–ª–∏–µ–Ω—Ç–∞"});
            setTimeout(() => {
              sendMessage(chatId, {type: 'text', text: "–ó–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ, –º–µ–Ω—è –∑–æ–≤—É—Ç –û–ª—å–≥–∞, —è –æ–ø–µ—Ä–∞—Ç–æ—Ä —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–æ–π –ø–æ–¥–¥–µ—Ä–∂–∫–∏ –∫–ª–∏–µ–Ω—Ç–∞. –ö–∞–∫–æ–π —É –í–∞—Å –≤–æ–ø—Ä–æ—Å"});
              sendMessage(chatId, {type: 'text', text: "–ò–¥–µ—Ç –∑–≤–æ–Ω–æ–∫..."});
              setTimeout(() => showQuestionSolvedModal(chatId, 'client'), 5000);
            }, 2000);
          } else {
            sendMessage(chatId, {type: 'text', text: "–ó–≤–æ–Ω–æ–∫ –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç—Å—è"});
            setTimeout(() => showQuestionSolvedModal(chatId, 'client'), 3000);
          }
        };
      };

      const showRatingModal = (chatId) => {
        const modal = document.createElement('div');
        modal.innerHTML = `
          <div class="overlay"></div>
          <div class="phone-modal">
            <h3>–û—Ü–µ–Ω–∏—Ç–µ –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏–µ</h3>
            <div class="rating-stars">
              <span class="star" onclick="window.setRating(1)">‚≠ê</span>
              <span class="star" onclick="window.setRating(2)">‚≠ê</span>
              <span class="star" onclick="window.setRating(3)">‚≠ê</span>
              <span class="star" onclick="window.setRating(4)">‚≠ê</span>
              <span class="star" onclick="window.setRating(5)">‚≠ê</span>
            </div>
            <button class="btn btn-primary" onclick="window.submitRating()" style="margin-top:15px;">–û—Ç–ø—Ä–∞–≤–∏—Ç—å –æ—Ü–µ–Ω–∫—É</button>
          </div>
        `;
        
        document.body.appendChild(modal);
        
        window.setRating = (stars) => {
          const starElements = modal.querySelectorAll('.star');
          starElements.forEach((star, index) => {
            star.classList.toggle('active', index < stars);
          });
          window.currentRating = stars;
        };

        window.submitRating = () => {
          const finalRating = window.currentRating || 0;
          modal.remove();
          if (finalRating > 0) {
            // –ê—Ä—Ö–∏–≤–∏—Ä—É–µ–º —á–∞—Ç
            const archivedChat = {
              usNumber,
              client: client.name,
              chatId,
              messages: [], // –í —Ä–µ–∞–ª—å–Ω–æ—Å—Ç–∏ –∑–¥–µ—Å—å –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å —Å–æ–æ–±—â–µ–Ω–∏—è —á–∞—Ç–∞
              rating: finalRating,
              createdAt: Date.now()
            };
            // –ó–¥–µ—Å—å –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –ª–æ–≥–∏–∫–∞ –∞—Ä—Ö–∏–≤–∞—Ü–∏–∏
            setTimeout(() => navigate('#/'), 1000);
          }
        };
      };

      const handleLoadRequest = (type) => {
        const chatId = getChatIdForButton('load');
        const initialMessage = type === 'load' 
          ? `–ó–∞–ø—Ä–æ—Å –Ω–∞ —Å—Ç–∞—Ç—É—Å –∑–∞–≥—Ä—É–∑–∫–∏ –£–° ‚Ññ${usNumber} –∫–ª–∏–µ–Ω—Ç–∞ ${client.name}`
          : `–ó–∞–ø—Ä–æ—Å –Ω–∞ —Å—Ç–∞—Ç—É—Å –≤—ã–≥—Ä—É–∑–∫–∏ –£–° ‚Ññ${usNumber} –∫–ª–∏–µ–Ω—Ç–∞ ${client.name}`;
        
        startAutoChatSequence(chatId, type, { initialMessage });
      };

      const handleEmergency = () => {
        const chatId = getChatIdForButton('emergency');
        startAutoChatSequence(chatId, 'emergency');
      };

      const handleExtraTime = () => {
        const chatId = getChatIdForButton('extraTime');
        sendMessage(chatId, {type: 'text', text: `–û–∂–∏–¥–∞–Ω–∏–µ —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏—è –¥–æ–ø. –≤—Ä–µ–º–µ–Ω–∏ –ø–æ –£–° ‚Ññ${usNumber} –∫–ª–∏–µ–Ω—Ç–∞ ${client.name}`});
        navigate(`#/chat/${chatId}/${usNumber}`);
        
        setTimeout(() => {
          const approved = Math.random() > 0.5;
          if (approved) {
            sendMessage(chatId, {type: 'text', text: "–í—Ä–µ–º—è —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–æ"});
          } else {
            sendMessage(chatId, {type: 'text', text: "–í—Ä–µ–º—è –Ω–µ —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–æ, –æ—Å—É—â–µ—Å—Ç–≤–ª—è–µ—Ç—Å—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –æ–ø–µ—Ä–∞—Ç–æ—Ä–∞ –°–ü–ü–û–£–°"});
            setTimeout(() => {
              sendMessage(chatId, {type: 'text', text: "–ó–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ! –Ø –æ–ø–µ—Ä–∞—Ç–æ—Ä –°–ü–ü–û–£–°, –º–µ–Ω—è –∑–æ–≤—É—Ç –ò–≥–æ—Ä—å, –∫–∞–∫–æ–π —É –í–∞—Å –≤–æ–ø—Ä–æ—Å"});
              sendMessage(chatId, {type: 'text', text: "–ò–¥–µ—Ç –∑–≤–æ–Ω–æ–∫"});
              setTimeout(() => showQuestionSolvedModal(chatId, 'sppous'), 3000);
            }, 2000);
          }
        }, 3000);
      };

      const handleNoAccess = () => {
        const chatId = getChatIdForButton('noAccess');
        startAutoChatSequence(chatId, 'noAccess', { 
          initialMessage: `–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –¥–æ—Å—Ç—É–ø–∞ –∫ –£–° ‚Ññ${usNumber} –∫–ª–∏–µ–Ω—Ç–∞ ${client.name}`
        });
      };

      const handlePhoneCall = () => {
        const phoneNumber = '+74951234567';
        window.open(`tel:${phoneNumber}`, '_self');
      };

      return e('div',null,
        e('div',{className:'service-header'},
          e('div',{className:'client-info'},
            e('div',{className:'client-logo', style:{background:client.color}}, client.logo),
            e('h2',null, `–£–° ‚Ññ${usNumber}`)
          ),
          e('p',{style:{opacity:0.8,margin:0}}, `–ö–ª–∏–µ–Ω—Ç: ${client.name}`)
        ),
        
        e('div',{className:'service-actions'},
          e('button',{className:'service-btn-instructions', onClick:()=> navigate(`#/instructions/${usNumber}`)},
            e('i',{className:'tile-icon', 'data-lucide':'file-text'}), 
            e('span',null, '–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏')
          ),
          e('button',{className:'service-btn', onClick:()=> handleLoadRequest('load')},
            e('i',{className:'tile-icon', 'data-lucide':'download'}), 
            e('span',null, '–ó–∞–≥—Ä—É–∑–∫–∞')
          ),
          e('button',{className:'service-btn', onClick:()=> handleLoadRequest('unload')},
            e('i',{className:'tile-icon', 'data-lucide':'upload'}), 
            e('span',null, '–í—ã–≥—Ä—É–∑–∫–∞')
          ),
          e('button',{className:'service-btn', onClick:handleNoAccess},
            e('i',{className:'tile-icon', 'data-lucide':'lock'}), 
            e('span',null, '–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –¥–æ—Å—Ç—É–ø–∞')
          ),
          e('button',{className:'service-btn emergency', onClick:handleEmergency},
            e('i',{className:'tile-icon', 'data-lucide':'alert-triangle'}), 
            e('span',null, '–§–û–†–°-–ú–ê–ñ–û–†')
          ),
          e('button',{className:'service-btn', onClick:handleExtraTime},
            e('i',{className:'tile-icon', 'data-lucide':'clock'}), 
            e('span',null, '–î–æ–ø. –≤—Ä–µ–º—è')
          )
        )
      );
    }

    function InstructionsPage({usNumber, navigate}){
      const client = CLIENTS_DATA[usNumber] || CLIENTS_DATA[1];
      
      return e('div',null,
        e('div',{className:'instr-header'},
          e('button',{className:'back', onClick:()=> navigate(`#/service/${usNumber}`)},
            e('i',{className:'tile-icon', 'data-lucide':'arrow-left', style:{width:'16px',height:'16px'}}),
            '–ù–∞–∑–∞–¥'
          ),
          e('h2',null, `–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –¥–ª—è –£–° ‚Ññ${usNumber}`)
        ),
        e('div',{className:'placeholder'},
          e('img',{src:'assets/sbercat.png', onError:(e)=>{e.target.src='assets/default_placeholder.png'}}),
          e('p',null, `PDF –¥–æ–∫—É–º–µ–Ω—Ç —Å –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è–º–∏ –¥–ª—è ${client.name} ‚Äî –≤ –Ω–∞—Å—Ç–æ—è—â–∏–π –º–æ–º–µ–Ω—Ç –ø–∞–º—è—Ç–∫–∞ —Ä–∞–∑—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è, –≤–æ–∑–≤—Ä–∞—â–∞–π—Ç–µ—Å—å –ø–æ–∑–∂–µ...`)
        )
      );
    }

 function ChatPage({
  chatId,
  usNumber,
  chats,
  onSend,
  onAttach,
  onImage,
  onArchive,
  onClearChat,
  navigate,
}) {
  useLucideIcons();
  const [text, setText] = useState("");
  const [isArchived, setIsArchived] = useState(false);
  const messagesRef = useRef(null);
  const fileRef = useRef(null);
  const cameraRef = useRef(null);
  const client = CLIENTS_DATA[usNumber] || CLIENTS_DATA[1];

  useEffect(() => {
    if (messagesRef.current)
      messagesRef.current.scrollTop = messagesRef.current.scrollHeight;
  }, [chats]);

  useEffect(() => {
    if (window.lucide) {
      window.lucide.createIcons();
    }
  });

  const handleSend = () => {
    if (!text.trim() || isArchived) return;
    onSend({ type: "text", text });
    setText("");
  };

  const handleAttach = (e) => {
    if (isArchived) return;
    const f = e.target.files && e.target.files[0];
    if (!f) return;
    onAttach(f);
    e.target.value = "";
  };

  const handleCamera = (e) => {
    if (isArchived) return;
    const f = e.target.files && e.target.files[0];
    if (!f) return;
    onImage(f);
    e.target.value = "";
  };

  const handlePhoneCall = () => {
    const phoneNumber = "+74951234567";
    window.open(`tel:${phoneNumber}`, "_self");
  };

  const showRatingModal = () => {
    const modal = document.createElement("div");
    modal.innerHTML = `
      <div class="overlay"></div>
      <div class="phone-modal">
        <h3>–û—Ü–µ–Ω–∏—Ç–µ –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏–µ</h3>
        <div class="rating-stars">
          <span class="star" onclick="window.setRatingChat(1)">‚≠ê</span>
          <span class="star" onclick="window.setRatingChat(2)">‚≠ê</span>
          <span class="star" onclick="window.setRatingChat(3)">‚≠ê</span>
          <span class="star" onclick="window.setRatingChat(4)">‚≠ê</span>
          <span class="star" onclick="window.setRatingChat(5)">‚≠ê</span>
        </div>
        <button class="btn btn-primary" onclick="window.submitRatingChat()" style="margin-top:15px;">–û—Ç–ø—Ä–∞–≤–∏—Ç—å –æ—Ü–µ–Ω–∫—É</button>
      </div>
    `;

    document.body.appendChild(modal);

    window.setRatingChat = (stars) => {
      const starElements = modal.querySelectorAll(".star");
      starElements.forEach((star, index) => {
        star.classList.toggle("active", index < stars);
      });
      window.currentRatingChat = stars;
    };

    window.submitRatingChat = () => {
      const finalRating = window.currentRatingChat || 0;
      modal.remove();
      if (finalRating > 0) {
        const archivedChat = onArchive({
          usNumber,
          client: client.name,
          chatId,
          messages: chats,
          rating: finalRating,
          createdAt: Date.now(),
        });

        onClearChat();
        setIsArchived(true);
        setTimeout(() => navigate("#/"), 1000);
      }
    };
  };

  const showExitConfirmModal = () => {
    const modal = document.createElement("div");
    modal.innerHTML = `
      <div class="overlay"></div>
      <div class="phone-modal">
        <h3>–ó–∞–≤–µ—Ä—à–∏—Ç—å —á–∞—Ç?</h3>
        <div style="display: flex; gap: 10px; justify-content: center; margin: 20px 0;">
          <button class="btn btn-primary" id="exit-yes">–î–∞</button>
          <button class="btn btn-neutral" id="exit-no">–ù–µ—Ç</button>
        </div>
      </div>
    `;

    document.body.appendChild(modal);

    document.getElementById("exit-yes").onclick = () => {
      modal.remove();
      showRatingModal();
    };

    document.getElementById("exit-no").onclick = () => {
      modal.remove();
    };
  };

  // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–Ω–æ–ø–∫–∏ –Ω–∞–∑–∞–¥
  const handleBackClick = () => {
    showExitConfirmModal();
  };

  const getChatTitle = () => {
    if (chatId === "curus") return "–¶–£–†–£–°";
    if (chatId === "client") return `–¢–ü –ö–ª–∏–µ–Ω—Ç–∞ (${client.name})`;
    return "–°–ü–ü–û–£–°";
  };

  return e(
    "div",
    { className: isArchived ? "archive-chat" : "" },
    e(
      "div",
      {
        style: {
          display: "flex",
          justifyContent: "space-between",
          alignItems: "center",
          marginBottom: 10,
        },
      },
      e(
        "div",
        {
          style: { display: "flex", alignItems: "center", gap: "8px" },
        },
        e(
          "button",
          { className: "back", onClick: handleBackClick },
          e("i", {
            className: "tile-icon",
            "data-lucide": "arrow-left", // –ò–°–ü–†–ê–í–õ–ï–ù–û: –±—ã–ª–∞ –æ—à–∏–±–∫–∞ —Å item.chatId
            style: { width: "16px", height: "16px" },
          }),
          "–ù–∞–∑–∞–¥"
        ),
        e("span", { style: { fontWeight: 700 } }, getChatTitle())
      )
    ),
    e(
      "div",
      { className: "chat-wrap" },
      e(
        "div",
        { ref: messagesRef, className: "messages" },
        (chats || []).map((m) => {
          if (m.type === "text")
            return e(
              "div",
              { key: m.id, className: "bubble me" },
              m.text,
              e(
                "div",
                { className: "msg-meta" },
                new Date(m.ts).toLocaleTimeString()
              )
            );
          if (m.type === "image")
            return e(
              "div",
              { key: m.id, className: "bubble me" },
              e("img", {
                src: m.url,
                style: { maxWidth: 220, borderRadius: 8 },
              }),
              e(
                "div",
                { className: "msg-meta" },
                new Date(m.ts).toLocaleTimeString()
              )
            );
          if (m.type === "file")
            return e(
              "div",
              { key: m.id, className: "bubble me" },
              e(
                "div",
                { className: "file-preview" },
                e(
                  "a",
                  { href: m.url, target: "_blank" },
                  m.fileName || "–§–∞–π–ª"
                )
              ),
              e(
                "div",
                { className: "msg-meta" },
                new Date(m.ts).toLocaleTimeString()
              )
            );
          return e(
            "div",
            { key: m.id, className: "bubble me" },
            JSON.stringify(m)
          );
        })
      ),
      e(
        "div",
        { className: "chat-input" },
        e("input", {
          type: "text",
          placeholder: isArchived
            ? "–ß–∞—Ç –∑–∞–≤–µ—Ä—à–µ–Ω"
            : "–ù–∞–ø–∏—à–∏—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ...",
          value: text,
          onChange: (e) => setText(e.target.value),
          onKeyDown: (ev) => {
            if (ev.key === "Enter") handleSend();
          },
          disabled: isArchived,
        }),
        e(
          "div",
          { className: "chat-actions" },
          e(
            "label",
            { className: "icon-btn", title: "–ü—Ä–∏–∫—Ä–µ–ø–∏—Ç—å —Ñ–∞–π–ª" },
            e("input", {
              type: "file",
              style: { display: "none" },
              ref: fileRef,
              onChange: handleAttach,
            }),
            e("i", {
              className: "tile-icon",
              "data-lucide": "paperclip",
              style: { width: "18px", height: "18px" },
            })
          ),
          e(
            "label",
            { className: "icon-btn", title: "–û—Ç–∫—Ä—ã—Ç—å –∫–∞–º–µ—Ä—É" },
            e("input", {
              type: "file",
              accept: "image/*",
              capture: "environment",
              style: { display: "none" },
              ref: cameraRef,
              onChange: handleCamera,
            }),
            e("i", {
              className: "tile-icon",
              "data-lucide": "camera",
              style: { width: "18px", height: "18px" },
            })
          ),
          e(
            "button",
            {
              className: "icon-btn",
              title: "–ü–æ–∑–≤–æ–Ω–∏—Ç—å",
              onClick: handlePhoneCall,
            },
            e("i", {
              className: "tile-icon",
              "data-lucide": "phone",
              style: { width: "18px", height: "18px" },
            })
          ),
          e(
            "button",
            {
              className: "btn btn-sm btn-primary",
              onClick: handleSend,
            },
            e("i", {
              className: "tile-icon",
              "data-lucide": "send",
              style: { width: "16px", height: "16px" },
            })
          )
        )
      )
    )
  );
}

    function ArchivePage({archive, navigate}){
      return e('div',null,
        e('div',{className:'instr-header'},
          e('button',{className:'back', onClick:()=> navigate('#/')},
            e('i',{className:'tile-icon', 'data-lucide':'arrow-left', style:{width:'16px',height:'16px'}}),
            '–ù–∞–∑–∞–¥'
          ),
          e('h2',null, '–ê—Ä—Ö–∏–≤ –æ–±—Ä–∞—â–µ–Ω–∏–π')
        ),
        e('div',null,
          archive.length === 0 
            ? e('div',{style:{textAlign:'center',opacity:0.8,padding:'40px'}}, 
                e('i',{className:'tile-icon', 'data-lucide':'inbox', style:{fontSize:'48px',marginBottom:'16px',display:'block',opacity:0.5}}),
                '–ê—Ä—Ö–∏–≤ –ø—É—Å—Ç'
              )
            : archive.map(item => e('div',{
                key:item.id,
                className:'service-btn',
                style:{marginBottom:'10px', cursor: 'pointer'},
                onClick: () => navigate(`#/archive-view/${item.id}`)
              }, 
                e('div',{style:{display:'flex', alignItems:'center', gap:'8px', marginBottom:'4px'}},
                  e('i',{className:'tile-icon', 'data-lucide':item.chatId === 'client' ? 'message-circle' : 'headphones', style:{width:'16px',height:'16px'}}),
                  e('div',{style:{fontWeight:'bold'}}, `–£–° ‚Ññ${item.usNumber} - ${item.client}`)
                ),
                e('div',{style:{fontSize:'12px',opacity:0.7}}, 
                  `–ó–∞–∫—Ä—ã—Ç–æ: ${new Date(item.closedAt).toLocaleString()}`
                ),
                item.rating && e('div',{style:{fontSize:'12px',color:'#ffd700'}}, 
                  `–û—Ü–µ–Ω–∫–∞: ${'‚≠ê'.repeat(item.rating)}`
                )
              ))
        )
      );
    }

    function ArchiveViewPage({archive, archiveId, navigate}){
      const archivedChat = archive.find(item => item.id === archiveId);

      if (!archivedChat) {
        return e('div',null,
          e('div',{className:'instr-header'},
            e('button',{className:'back', onClick:()=> navigate('#/archive')},
              e('i',{className:'tile-icon', 'data-lucide':'arrow-left', style:{width:'16px',height:'16px'}}),
              '–ù–∞–∑–∞–¥'
            ),
            e('h2',null, '–û–±—Ä–∞—â–µ–Ω–∏–µ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ')
          )
        );
      }

      return e('div',null,
        e('div',{className:'instr-header'},
          e('button',{className:'back', onClick:()=> navigate('#/archive')},
            e('i',{className:'tile-icon', 'data-lucide':'arrow-left', style:{width:'16px',height:'16px'}}),
            '–ù–∞–∑–∞–¥'
          ),
          e('h2',null, `–ê—Ä—Ö–∏–≤: –£–° ‚Ññ${archivedChat.usNumber}`)
        ),
        e('div',{style:{marginBottom:'16px', background:'var(--glass-bg)', padding:'16px', borderRadius:'var(--radius)', border:'1px solid var(--glass-border)'}},
          e('div',{style:{display:'flex', alignItems:'center', gap:'8px', marginBottom:'8px'}},
            e('i',{className:'tile-icon', 'data-lucide':'building', style:{width:'16px',height:'16px'}}),
            e('div',{style:{opacity:0.8}}, `–ö–ª–∏–µ–Ω—Ç: ${archivedChat.client}`)
          ),
          e('div',{style:{display:'flex', alignItems:'center', gap:'8px', marginBottom:'8px'}},
            e('i',{className:'tile-icon', 'data-lucide':archivedChat.chatId === 'client' ? 'message-circle' : 'headphones', style:{width:'16px',height:'16px'}}),
            e('div',{style:{opacity:0.8}}, `–ß–∞—Ç: ${
  archivedChat.chatId === 'curus' ? '–¶–£–†–£–°' : 
  archivedChat.chatId === 'client' ? '–¢–ü –ö–ª–∏–µ–Ω—Ç–∞' : '–°–ü–ü–û–£–°'
}`)
          ),
          e('div',{style:{display:'flex', alignItems:'center', gap:'8px', marginBottom:'8px'}},
            e('i',{className:'tile-icon', 'data-lucide':'calendar', style:{width:'16px',height:'16px'}}),
            e('div',{style:{opacity:0.8}}, `–ó–∞–∫—Ä—ã—Ç–æ: ${new Date(archivedChat.closedAt).toLocaleString()}`)
          ),
          archivedChat.rating && e('div',{style:{display:'flex', alignItems:'center', gap:'8px'}},
            e('i',{className:'tile-icon', 'data-lucide':'star', style:{width:'16px',height:'16px',color:'#ffd700'}}),
            e('div',{style:{color:'#ffd700'}}, `–û—Ü–µ–Ω–∫–∞: ${'‚≠ê'.repeat(archivedChat.rating)}`)
          )
        ),
        e('div',{className:'archive-messages'},
          (archivedChat.messages || []).map(m => {
            if(m.type==='text') return e('div',{key:m.id,className:'bubble me'}, m.text, e('div',{className:'msg-meta'}, new Date(m.ts).toLocaleTimeString()));
            if(m.type==='image') return e('div',{key:m.id,className:'bubble me'}, e('img',{src:m.url, style:{maxWidth:220,borderRadius:8}}), e('div',{className:'msg-meta'}, new Date(m.ts).toLocaleTimeString()));
            if(m.type==='file') return e('div',{key:m.id,className:'bubble me'},
              e('div',{className:'file-preview'}, e('a',{href:m.url, target:'_blank'}, m.fileName || '–§–∞–π–ª')),
              e('div',{className:'msg-meta'}, new Date(m.ts).toLocaleTimeString())
            );
            return e('div',{key:m.id,className:'bubble me'}, JSON.stringify(m));
          })
        )
      );
    }

    // –†–µ–Ω–¥–µ—Ä–∏–Ω–≥ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
    ReactDOM.render(e(App), document.getElementById('root'));

    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Lucide Icons –ø–æ—Å–ª–µ —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–∞
    setTimeout(() => {
      if (window.lucide) {
        window.lucide.createIcons();
      }
    }, 100);
  })();
  </script>
  
  <!-- Video background -->
  <video autoplay muted loop playsinline class="video-background">
    <source src="assets/Dark.mp4" type="video/mp4">
    –í–∞—à –±—Ä–∞—É–∑–µ—Ä –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –≤–∏–¥–µ–æ.
  </video>
  <div class="overlay-dark"></div>
</body>
</html>